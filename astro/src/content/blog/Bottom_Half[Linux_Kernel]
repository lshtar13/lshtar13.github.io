---
title: 'Ch8. Bottom Halves and Deferring Work [Linux Kernel]'
description: 'Linux Kernel Development 3rd'
pubDate: 'Oct 17 2024'
heroImage: 
  src: '/blog-placeholder-4.jpg'
  alt: ''
tags: ["Linux", "Kernel", "Interrupt", "Bottom half", "softirq", "workqueue"]
series: "Linux Kernel"
---

# Material
Robter Love의 [Linux Kernel Development 3rd](https://www.amazon.com/Linux-Kernel-Development-Robert-Love/dp/0672329468)를 공부하며 정리한 것. 리눅스 커널 `v2.6` 기준.

# Two Part of Interrupt Handling
Interrupt handling은 두 부분, Top half(전반부 처리, TH)와 Bottom half(후반부 처리, BH)으로 나뉜다. Interrupt handling은 process context와는 다른 interrupt context에서,
다른 interrupt를 막아둔 채로 이루어지기 때문에 빠른 처리가 이루어져야 한다. 다른 프로세스들의 작업이 지연되기 때문이다. 빠른 처리를 위해서 interrupt handling을 두 부분으로 나눈 것이다.</br>
TH에서는 interrupt context에서 다른 interrupt의 방해 받지 않는 환경에서 이루어져야하는 필수적인 작업들만 이루어진다. 하드웨어에 interrupt에 대한 ack를 보내는 등의 작업들이 이루어진다. 
BH에서는 이와는 다르게, 특수한 환경이 필요하지 않고 시간에 구애받지 않거나 시간이 많이 걸리는 작업들이 이루어진다. 네트워크 장치로부터 수신내용을 복사하는 등의 작업들이 이루어진다.

# Bottom Half
BH를 수행하는데 사용되는 방식은 크게 두가지이다. softirq와 workqeue가 그것인데, softirq를 이용한 tasklet도 존재한다. 각각 구현 방식과 그 쓰임새가 다르다.
## softirq
softirq는 프로세서별로 수행되는, 정적으로 등록된 작업들을 수행하는 BH 구현 방식이다. softirq 방식을 통해 수행되는 작업들은 컴파일시에 고정되며, 프로세서별로 해당 작업 집합 내에서 필요한 작업들을 수집하여 수행한다. 
softirq 작업은최대 32개까지 등록될 수 있으며, v2.6.34기준으로 9개가 등록되어있다. 각 softirq 작업들은 0~8까지의 인덱스를 가지며, 인덱스가 작을수록 먼저 수행된다.
